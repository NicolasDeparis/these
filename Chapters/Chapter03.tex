\chapter{La composante stellaire}


Maintenant que nous avons survolé toutes les physiques a l’œuvre dans ce type de simulation, concentrons nous sur les sources lumineuse.
comme nous avons vu, il existe deux types de sources, les étoiles et les quasars. %TODO ref
Je n'ai considérer que la partie stellaire.

L'objectif de cette section est d'exposer le modelé stellaire que j'ai développé.
Nous allons définir les différentes phase de la vie d'une étoile, et ses différentes évolution possible.
Nous verrons qu'elles sont les contraintes imposées par la résolution des simulations cosmologique.



\section{Les différentes phases de la vie d'une étoile}


définition d'une étoile


\subsection{Naissance}

%lien avec la densité\\
%Formation dans l'H moléculaire mais pas dans les simu

En principe une étoile se forme par effondrement gravitationnel.
Dans un nuage, si le temps de chute libre est supérieur au temps de rection a une perturbation le milieu n'a pas le temps de résister a son effondrement et le gaz s'effondre sur lui même.
Cette ne s’arrête que quand les réaction thermonucléaire s'enclenche et que le gaz forme une étoile.

Il y a effondrement si:
\begin{equation}
t_{ff} < t_{sound},
\end{equation}

avec:
 
\begin{equation}
t_{ff} = \frac{1}{\sqrt{G \rho}},
\end{equation}

et 

\begin{equation}
t_{sound} = \frac{R}{C_s},
\end{equation}

Ici intervient la densité, plus le milieu est dense plus il aura tendance a s'effondrer sur lui même.
D'un autre coté intervient aussi la vitesse du son $C_s$, elle même dépendante de la température $C_s \propto \sqrt{T}$.
Plus le gaz sera chaud, plus le nuage devra être gros pour pouvoir s’effondrer.



\subsection{Population III}

%tres peu de ligne de refroisdissment
%étoiles plus grosse
% temps de vie court

Or a haut redshift, au moment de l'apparition des premières étoiles, les métaux étaient trés peux disponible (cf nucléosynthèse primordiale) %TODO ref
De ce fait, le gaz disposait de relativement peu de possibilité de refroidissement, et donc la température du gaz devait être élevée.
Les étoiles primordiales devaient donc être plus grosses que les étoiles de notre voisinage (plus de 100Mo).
Ce type d'étoiles est appelées étoiles de population III.
Du fait de leur masse, elles émettait un fort rayonnement ionisant, et avaient une vie relativement courte.



%La nucléosynthèse primordiale a créer peu de métaux. 
%A haut redshift, les metaux etaient peu disponible.
%les métaux permettent une meilleur emmission radiative, et donc un meilleur refroidissent.
%si le refroidissment est meilleur, l'equilibre hydrostatique penche an faveur de plus grosse étoiles.
%POPIII, IMF top Heavy, étoiles  primordiales
%
%plus un étoiles est grosse, plus son spectre sera énergétique et plus la portion de spectre ionisant sera important.



\subsection{sequence principale}

%le diagram HR


Une fois le nuage de gaz effondré et les réaction thermonucléaire amorcées.
l'étoiles amorce sa séquence principale.
C'est la phase qui représente la majore partie de la vie d'une étoile.
Elle consiste en un équilibre hydrostatique entre gravitation et réaction de fusion nucléaire nucléaire.

%develloper le cycle proton proton ?
Équation simplifié du processus de fusion:
\begin{equation}
4p \leftrightarrow He^4 + 2e+ + 2\nu + E
\end{equation}

L'étoile va donc consommer son hydrogène pour résister a l’effondrement gravitationnel.
Il en résultera la formation d'hélium.

Plus une étoile est grosse plus le taux de réaction doit être élevé pour lutter contre la gravité.
Il en résulte que les grosse étoiles sont plus énergétique, et emmetent donc plus de rayonnement ionisant.
Mais ce taux de réaction élévé mêne a une durée de vie plus courte.

%materiaux de base est l'hydrogene\\
%plasma donc hydrogène ionisé 

\subsection{mort}

Arrivé a un certain taux de consommation d'hydrogène, 
les réactions ne sont plus suffisante et l'étoile s’effondre.
En fonction de sa masse, plusieurs scénario d’évolution sont possibles:


%Consomation du materiaux de base

géante rouge\\
naine blanche\\
trou noir\\
supernovae\\
formation d'elements lourd (>Fe)
enrichissement du milieu







A la fin de se vie, une étoile a consommée la plus grande partie de son hydrogène disponible.
l'équilibre radiatif est rompu et l'étoile s'éffondre.
cette augmentation de la pression amorce une serie de fusion nucléaire d’élément plus lourd que l’hydrogène.
cycle CNO
Une fois arrivé au Fe, il devient coûteux de continuer a fusionner.
FE le plus stable



Géante rouge

En fonction de la masse:
naine blanche (pression de dégénérescence des électrons)
étoile a neutron (pression de dégénérescence des neutrons)
trou noir (singularité)



Différents type de supernovae

I -> binaire accrétante du compagnon -> passage au dessu de la limite.
II -> l'étoile est assez massive au départ (M>8Mo)


Les supernovae ont été introduite dans les simulations cosmologiques pour contre ballancer "l'overcooling probleme".
Sans l'introduction d'énergie dans le gaz par les supernovae, le gas s'éffondre de manière importante et créer un nombre élevé d'étoiles.
cela mène a un taux de formation stellaire trop important par rapport a ce qui est observé.



les superbubbles
A la manière de la percollation des bulles de HII, les bulles de supernovae 





\section{Population stellaire et modèle sous grille}

\subsection{Problème de résolution}

%En fonction des echelles de travail, nous considererons soit les etoiles individuelles soit une population stellaire.


Une des difficulté des modèles stellaire dans les simulations de réionisation, et le manque de résolution.
Il existe toujours ce conflit en réionisation entre simuler des grands volume, et obtenir la meilleur résolution possible.
Actuellement les simulations les plus résolues et capable de suivre un volume d'Univers suffisant atteigne un résolution de l'ordre de la centaine de parsec.
Or les échelles de formation stellaire sont de l'ordre de l'unité astronomique, soit un facteur $\approx 10^6$ plus petit.
Il n'est donc actuellement pas possible de suivre la formation des étoiles individuellement.

Il nous faut créer un modèle qui va tenter de prendre en compte au mieux la physique non résolue.
Ce type de modèle est appelé modèle sous grille.

Dans le cas présent le modèle sous grille consiste a transformer une partie du gaz en particule stellaire.
On appelle ces particules des particules puits.
Toute la difficulté du modèle de formation stellaire sera de déterminer la façon dont est réalisée cette conversion.
Malgré tout, nous verrons qu'il est possible d'obtenir un modèle statistiquement viable a grandes échelles assez facilement.

Un second type de modèle intervient au moment de l'explosion en supernovae.
Les processus de diffusion de l'énergie libérée aux échelles plus petite que la grille sont complexe et il en résulte une série de paramètres libres assez conséquente.

%lien entre les différents solveurs en fonction du stade évolutif
Les étoiles se trouvent aux centre de la simulation.
En effet, créer une étoiles consiste a transformer une partie du gaz en particule.
Cette particule sera ensuite gérée par le solveur Ncorps, et servira de source au solveur radiatif.
Puis a la fin de sa vie, l'étoile va injecter de l'énergie dans le solveur hydrodynamique.
Une particule stellaire va donc devoir interagir avec tout les solveurs du code.




%Seul la partie du spectre capable de ioniser l'hydrogène est considérée. E>13.6eV



\subsection{Fonction de masse Initiale}

Les étoiles naissent en groupe.
La probabilité de former une étoile d'une certaine masse est régie par la fonction de masse initiale (IMF)
Il existe différentes IMF, parmi les plus connues il y a :

\begin{itemize}
\item \cite{1955ApJ...121..161S}
\item \cite{1979ApJS...41..513M}
\item \cite{2001MNRAS.322..231K}
\item \cite{2003PASP..115..763C}
\end{itemize}

Comme nous l'avons abordé plus haut, les étoiles de population III avaient tendence a être tres massive.
De plus, certain travaux (eg \cite{2003MNRAS.344L...7C} ) sugère une IMF top heavy, c'est a dire une IMF avec une proportion d'étoile massive très importante.
La majorité des simulations que j'ai réalisées utilisent une IMF Top-Heavy.

J'ai commencé mes calibrations avec une IMF de Salpeter, mais il s'est vite avéré que les sources n’émettaient pas assez de photons et que les boites n'arrivaient pas a reioniser
%: difficulté a reioniser avec Salpeter -> passage a top heavy -> justification 
%Fonction de masse IMF Top Heavy


\subsection{Starburst99}

%Pour modeliser 
%paramètre d'entrée
%sorties

La modalisation de population stellaire est complexe, et il existe différent modèles complets.
J'ai choisi d'utilisé Starburst99 \citep{leitherer_starburst99:_1999} mais il en existe d'autres : \cite{2003MNRAS.344.1000B} , FSPS \cite{2009ApJ...699..486C}.  
%TODO mettre les differnts models

A partir d'information caractéristique d'une population stellaire, comme sa masse, son IMF ou sa métallicité, Starburst99 retourne le spectre d'émission de cette population en fonction du temps cf (Fig \ref{fig:spectre_starburst}).

\begin{figure}[htbp]
        \includegraphics[width=.95\linewidth]{img/03/spectre_starburst.jpg} 
        \caption{Spectre d'émission d'une population stellaire généré par Starburst99.
        Ici avec les paramètres M=1e6 Mo, IMF de Salpeter ($\alpha=2.35$ et intégration de 1 a 100 M$_\odot$ }
 		\label{fig:spectre_starburst}
\end{figure}

Un avantage de Starburst99 par rapport a d'autre modèle et qu'il retourne également de l'information utile pour la modélisation des supernovae.
Nous y reviendrons dans la section dédiée. %TODO ref


\section{La formation stellaire}

\subsection{Localisation des zones de formation stellaire}

Il est admis que les étoiles se forment dans les nuage moléculaires.
Ces nuages ce trouvent eux meme dans des zones suffisement dense pour que les molecules puissent se former.
En pratique dans EMMA, 
%la physique de l'hydrogene moléculaire n'est pas prisent en compte 
Les zones capables de former des étoiles sont localisées a l'aide d'un seuil en densité.
Toutes les cellules en dessous d'un certain seuil ne sont pas authorisée a créer des particules stellaire.

%Seuil en densité \\
\begin{equation}
	flag = 
  \begin{cases}
      True, & \text{if } \rho > \rho_{thresh}\\
      False,              & \text{otherwise}
  \end{cases}
\end{equation} 

Cette densité de seuil $\rho_{thresh}$ peux être définie arbitrairement.
Comme toute densité, elle est dépendante de la résolution.
De plus il en possible de définir une densité en unité physique ou en unité commobile.
Un seuil en densité physique sera plus représentatif de se qui se passe réellement.
Mais a haut redshift, la densité était haute partout, et un seuil en unité comobile est utile pour limité l'aparition des premières étoiles a un redshift donné.
%TODO figure du seuil en fonction du redshift
En pratique on pourra définir ces deux seuil, et le seuil final sera le plus contraignant des deux.

\begin{equation}
	\rho_{thresh} = max\left(  \delta_{in} \bar{\rho}, \rho_{in} a^3 \right)
\end{equation} 

ou $\delta_{in}$ et $\rho_{in}$  sont respectivement les paramètre de surdensité et de densité physique.
$\delta_{in}$est exprimé en unité comobile et est donc constant dans le temps en unité du code
 $\rho_{in}$ est exprimé en unité physique (en atome par metre cube), sa valeur evolue dans le temps du point de vue des unité du codes.

% determination de la valeur de 55\\ 



\subsection{La loi de schmidt-kennicut}
 %conversion densité surfacique vers densité 3D\\
%rho 1.5\\
%temps de free fall\\

Maintenant que nous avons définis ou former des étoiles, il faut calculer combien nous devons en former.

La loi de Schmidt %TODO ref
est une loi observationnelle qui lie la densité surfacique de gaz dans les galaxies au taux de formation stelaire (SFR) dans cette galaxie.
Kennicut %TODO ref
a utilisé un model de galaxie pour dé projeté la densité surfacique observé et ainsi determiner une loi qui lie le SFR a la densité volumique de gaz.

Il est arrivé a une loi de la forme:
\begin{equation}
SFR \propto \rho ^{\alpha}
\end{equation}

avec $\alpha \approx 1.5$

 
Le taux de formation stellaire s'exprime généralement en $M_\odot \cdot Mpc^{-3}  \cdot yr^{-1}$  
Ce qui est homogène a une densité divisé par un temps.


En pratique divisera $\rho_g$ la densité de gaz locale par le temps de chute libre ,
\begin{equation}
t_{ff} = \sqrt{\frac{3\pi}{32G\rho_g}}.
\end{equation}

Ce qui nous mène a considérer, dans les cellules autorisée, une SFR sous la forme:

\begin{equation}
	SFR = \epsilon_{sf} \frac{\rho_g}{t_{ff}}
    \label{eq_sfr}
\end{equation}

avec  $\epsilon_{sf}$ le paramètre d'efficacité de formation stellaire.
Observationellement, $\epsilon_{sf}$  est de l'ordre du \%. %TODO ref
Ce qui signifie que la formation stellaire est relativement inéfficace.
Utiliser le temps de chute libre dans cette expression fait sens puisque en théorie c'est le temps qu'il faudrait a un nuage de gaz pour s'effondrer si il n'y avait aucune resistance.
En pratique le temps caractéristique de formation stellaire:
\begin{equation}
t_{sf} =  \frac{t_{ff}}{ \epsilon_{sf} },
\end{equation}
est de l'ordre de quelques milliard d'années.

A partir de ce taux de formation on obtient la masse de gaz a convertir en étoile dans chaque cellule en multipliant par $dv$ le volume de la cellule en question et $dt$ le pas de temps entre deux passage dans la fonction de formation stellaire.

\begin{equation}
	M_{star} = SFR . dv .dt 
\end{equation}

%resolution en masse\\

Nous avons donc a ce stade la masse totale de gaz a convertir en étoile.
Il devient rapidement couteux de générer pour chaque cellule éligible, et a chaque pas de temps, une nouvelles particule stellaire (le nombre de particule peux rapidement exploser.
Nous adoptons une approche probabiliste.
Nous définissons une masse d'étoiles $m_{star}$ qui correspondra a notre "quanta stellaire".
toutes les étoiles aurons donc la même masse.
La masse des étoiles est calculée d'une manière comparable a la masse d'une particule de matière noire.
la masse d'une étoile correspond a la masse moyenne de gaz dans une cellules d'un certain niveau pouvant aller du niveau coarse $m_star = M_{DM} \frac{\Omega_b}{\Omega_m}$ au niveau plusieurs niveau raffiné.


Et nous tirons le nombre de quanta a ajouter aléatoirement dans une lois de Poisson.

\begin{equation}
	P(N) = \frac{\lambda^N}{N!} e^{-\lambda}
\end{equation}

Ou $\lambda$ correspond au nombre de particule moyen a créer dans la cellule :
\begin{equation}
\lambda = \frac{ M_{star}}{m_{star}}
\end{equation}
Étant donné le grand nombre de tirage cette loi est en moyenne valide.
On obtiendra au final $N_{star}$ le nombre de quanta de masse d'étoile a créer.


En pratique j'ai implémenté deux méthodes de transformations.
Si  $N_{star}>1$ il est possible de créer : 
\begin{itemize}
\item  $N_{star}$ particules aillant chacune une mass  $m_{star}$.
\item une seule particule de masse  $N_{star} \cdot m_{star}$.
\end{itemize}

Dans le premier cas le nombre de particules sera plus élevée et la résolution stellaire meilleure, mais en contrepartie le cout numérique sera plus important.
Le choix de la méthode est laissé a l'utilisateur.

En pratique la création d'une particule stellaire consistera a 
\begin{itemize}
\item prendre dans la réserve, une nouvelle particule %un maillon de la liste chainée
\item ajouter ce nouveau maillons a la liste chainée de particule de la cellule.
\item initialiser cette nouvelle particule avec : 
\begin{itemize}
\item un état
\item un temps de création
\item une vitesse 
\item une masse
\item un identifiant
\end{itemize}
\end{itemize}


On associera un temps de création a la particule stellaire et non un age, ceci permet de ne pas avoir a remettre a jour cette valeur a chaque pas de temps.
Pendant les analyses post simulation, on prendra garde a définir l'age des étoiles comme étant le temps associé au snapshot courant moins le temps de création de la particule.

Les étoiles créées auront une vitesse aléatoire pour éviter les effets de "collier".


Il est utile d'associer un identifiant unique aux particules.
Cela permet de les retrouver entre les différents snapshot.
La technique la plus simple est d'associer la valeur d'un entier que l'on incrémente a chaque création d'une nouvelle particule.
Du fait de la parallélisation cette incrémentation est compliquée et demande des communications a chaque création de particule.
La pratique retenue consiste a former toutes les particules de toutes les processeurs, en leur assignant un identifiant caractéristique (ici -1) et d'assigner les identifiant finaux dans un second temps.
Une fois les particules créées,  on compte le nombre de nouvelles particules dans chaques processeurs.
Ce qui permet d'allouer une plage d'identifiants par processeurs, et ainsi allouer les identifiants finaux.


\section{Test}

Dans le but de tester cette implémentation, le premier test réalisé consiste a comparer la SFR cosmique de l'ensemble de la boite, aux observations.
Les points d'observations de Bouwens %TODO ref

%TODO mettre figure SFR qui passe dans les cloups.

Des test plus poussés seront développés plus loin.



\section{La vie radiative}
%injection d'énergie dans le solveur radiatif, ok mais combien?\\
%calibration energetique et Starburst99\\

Une fois les étoiles formées, il est nécessaire de les faire rayonner.
Pour ce faire il faut passer en revue toute les étoiles, et a partir de leurs masse et de leur age, calculer leurs émissivité.
Cette opération est simplifiée par l'utilisation de la liste chaînée de particule associées a chaque cellule. %TODO ref section
En effet, en pratique, on passera en revue toutes les cellules, et pour chaque cellules on passera en revue toutes ses particules.
On testera alors si une particules est une étoiles (la liste chainée contient également les particulke de matière noire), et si cette étoiles est dans un stade ou elle émet de l'énergie lumineuse.
Si c'est le cas, on calculera son émissivité et on injectera cette énergie sous forme de source dans l'équation \ref{eq:densite_energie}.
Le calcul de $\dot{N}_\nu^*$ sera effectué dans toutes les cellules.

La principale question a laquelle tente de répondre cette section est : Quel est le lien entre age, masse et luminosité d'une particule stellaire?
Pour répondre a cette question on utilisera un modèle de population stellaire.

A partir des spectres obtenus avec Starburst99, nous allons ne garder que la partie capable de ioniser l'hydrogène (toutes les longueurs d'onde plus petite que 911$\AA$) 

\begin{equation}
E_{ion} = \int_{13.6eV}^{+\inf} h \nu d\nu
\end{equation}

On obtient a partir de cette intégration, un profil de luminosité présenté sur la figure \ref{fig:flux}.

\begin{figure}[htbp]
        \includegraphics[width=.95\linewidth]{img/03/flux.pdf} 
        \caption{Émissivité ionisante intégrée en fonction du temps}
 		\label{fig:flux}
\end{figure}

Le profil obtenu présente un plateau d'émissivité constante suivie d'une rapide décroissance.
Ce profil peut être raisonnablement approximé par:

$
    S = 
\begin{cases}
    S_0 ,         & \text{if } t < t_{life}\\
    S_0.t^{-4},   & \text{if } t_{life} \leq t < 100.t_{life} \\
    0,   & \text{if } 100t_{life} \leq t
\end{cases}
$

Ce flux correspond au flux d'une population de $10^6M_\odot$.
Ces valeurs seront pondérées au prorata de la masse de la particule stellaire. (Une particule de $10^5M_\odot$ émettra 10 fois moins de photons).

Ce profil d’émission ionisante peut être découper en différents "groupe de photons" (cf section \ref{sec:groupedephotons}).
Il est possible de choisir un nombre arbitraire de groupes, mais il faut prendre en compte que chaque groupe devient l'équivalent d'un fluide dont on veut suivre l'évolution.
Le coût numérique augmente rapidement avec le nombre de groupes. 
J'ai implémenté la possibilité de découper les groupes, en fréquences, mais aussi en temps.
Malgré tout, le ratio cout de calcul sur amélioration des prédictions n'est pas en faveur de l'augmentation du nombre de groupes (dans le cas des résolution considérée pendant ma thèse).
En pratique on prendra un généralement un seul groupe de photons.

L’énergie moyenne d'un photon dans un groupe est calculée de la manière suivante:
\begin{equation}
<E> = \frac{1}{N} \int_{\nu_1}^{\nu_2} N_\nu h \nu d\nu
\end{equation}

et la section efficace d'intéraction:
\begin{equation}
\sigma_E = \frac{1}{N<E>} \int_{\nu_1}^{\nu_2} N_\nu h \nu d\nu
\end{equation}

Pour une IMF TopHeavy, les valeurs obtenues sont:


\begin{table}
\begin{tabular}{l l }
	$<h\nu>$	&  23.42 eV \\
	$\alpha_e$	&  $2.35.10^{-22}$ m$^2$ \\
	$\alpha_i$	&  $1.82.10^{-22}$ m$^2$ \\
\end{tabular}
\caption{Propriété des photon émis par les sources.
\label{tab_photon}}
\end{table}

La table \ref{tab_photon} présente les caractéristique des photons obtenus.


%TODO intégration de l'énergie et de la section efficace


%We found a mean energy of $<h\nu> = 23.42$ eV,
%an energy weighted cross section of
%$\alpha_e = 2.35.10^{-22}$ m$^2$
%and a number weighted cross section of
%$\alpha_i = 1.82.10^{-22}$ m$^2$


%Masse de la population\\
%produit en croix pour correspondre a la masse dans simu\\
%integration seulement sur energy ionisante\\
%
%Multigroupe frequence\\
%multigroup temporel\\


\section{le problème de la masse des étoiles}



%le paramètre de masse des étoiles change la reionization\\
%effet numérique\\
%le rayonnement est piégé dans les cellules\\

Durant mes calibrations, il s'est avéré que le paramètre de résolution de la masse des particules stellaire avait une grande importance dans l'évolution de la fraction ionisée.
Même si celui ci n'a pas d'impact sur la SFR globale, le taux d'ionisation moyen est fortement dépendant de ce paramètre.
Plus la résolution stellaire est élevée, plus la boite réionise tard.


%TODO ajouter les figures cf présentation pp




\input{Chapters/Chapter03_supernovae.tex}

